<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Space Shooter</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
<div id="game-container">
    <canvas id="game-canvas" width="800" height="600"></canvas>
    <div id="ui-overlay"></div>
</div>
<!-- MANDATORY: All scripts loaded in dependency order -->
<script src="audioManager.js"></script>
<script src="inputHandler.js"></script>
<script src="collisionSystem.js"></script>
<script src="entityManager.js"></script>
<script src="player.js"></script>
<script src="enemy.js"></script>
<script src="projectile.js"></script>
<script src="powerUp.js"></script>
<script src="scoreManager.js"></script>
<script src="uiManager.js"></script>
<script src="menuScene.js"></script>
<script src="gameScene.js"></script>
<script src="gameOverScene.js"></script>
<script src="stateManager.js"></script>
<script src="renderer.js"></script>
<script src="gameLoop.js"></script>
<script src="main.js"></script>

<script>
  // Auto-generated initialization fix with dependency validation
  function validateDependencies() {
    console.log('🔍 Validating game dependencies...');
    const requiredClasses = [];
    requiredClasses.push('Player');
    requiredClasses.push('Enemy');
    const missingClasses = [];
    const availableClasses = [];
    
    requiredClasses.forEach(className => {
      if (typeof window[className] !== 'undefined' && window[className] !== null) {
        availableClasses.push(className);
        console.log('✅ Class available:', className);
      } else {
        missingClasses.push(className);
        console.error('❌ Missing class:', className);
      }
    });
    
    if (missingClasses.length > 0) {
      console.error('🚨 Critical: Missing dependencies prevent game start:', missingClasses);
      return false;
    }
    
    console.log('✅ All dependencies validated successfully');
    return true;
  }

  function initializeGame() {
    console.log('🎮 Game initializing with enhanced validation...');
    
    // Step 1: Validate all dependencies are loaded
    if (!validateDependencies()) {
      console.error('🚨 Game initialization failed: Missing dependencies');
      alert('Game failed to load: Missing required classes. Please refresh and try again.');
      return;
    }
    
    // Step 4: Start game with comprehensive method detection
    setTimeout(() => {
      console.log('🚀 Attempting to start game...');
      let gameStarted = false;
      
      // Try comprehensive start method detection
      if (!gameStarted) {
        const startMethods = ['initGame', 'startGame', 'showMenu', 'init', 'start', 'showStartMenu', 'displayMenu'];
        
        for (const method of startMethods) {
          try {
            if (window.gameInstance && typeof window.gameInstance[method] === 'function') {
              console.log('🚀 Starting game with instance method:', method);
              window.gameInstance[method]();
              gameStarted = true;
              break;
            } else if (typeof window[method] === 'function') {
              console.log('🚀 Starting game with global function:', method);
              window[method]();
              gameStarted = true;
              break;
            }
          } catch (error) {
            console.warn('⚠️ Method', method, 'failed:', error.message);
          }
        }
      }
      
      if (!gameStarted) {
        console.error('🚨 No valid start method found. Game may not start properly.');
        console.log('🔍 Available methods on gameInstance:', Object.getOwnPropertyNames(window.gameInstance || {}));
        console.log('🔍 Available global functions:', Object.keys(window).filter(key => typeof window[key] === 'function'));
      } else {
        console.log('✅ Game started successfully!');
      }
    }, 150);
  }

</script>
</body>
</html>